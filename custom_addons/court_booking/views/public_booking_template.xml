<odoo>
<template id="booking_form_template" name="Public Booking Form">
  <t t-call="website.layout">
    <div class="container">
      <h2>Book a Court</h2>
      <form action="/submit-booking" method="POST">
        <div><input type="text" name="name" placeholder="Your Name" required="1"/></div>
        <div><input type="email" name="email" placeholder="Your Email" required="1"/></div>
        <div><input type="date" name="booking_date" required="1"/></div>

        <div>
          <label>Time Slot</label>
          <select name="slot_id" required="1">
            <t t-foreach="slots" t-as="slot">
              <option t-att-value="slot.id"><t t-esc="slot.name"/></option>
            </t>
          </select>
        </div>

        <div>
          <label>Available Court</label>
          <select name="court_id" required="1"></select>
        </div>

        <div>
          <label>Rackets Needed</label>
          <select name="racket_qty"></select>
          <div id="racket-note" class="text-info mt-2"></div>
        </div>

        <button type="submit">Book Now</button>
      </form>
    </div>
    <script type="text/javascript" src="/web/static/lib/jquery/jquery.js" />
    <script type="text/javascript">
    <![CDATA[
      $(document).ready(function () {
        function updateAvailability() {
          var date = $('input[name="booking_date"]').val();
          var slotId = $('select[name="slot_id"]').val();

          if (date && slotId) {
            $.ajax({
              url: '/check-availability',
              type: 'POST',
              contentType: 'application/json',
              data: JSON.stringify({
                booking_date: date,
                slot_id: slotId
              }),
              success: function (response) {
                const result = response.result;
                var $courtSelect = $('select[name="court_id"]');
                var $racketSelect = $('select[name="racket_qty"]');
                var $racketNote = $('#racket-note');

                $courtSelect.empty();
                if (result.available_courts.length === 0) {
                  $courtSelect.append('<option value="">No courts available</option>');
                } else {
                  $.each(result.available_courts, function (i, court) {
                    $courtSelect.append('<option value="' + court.id + '">' + court.name + '</option>');
                  });
                }

                $racketSelect.empty();
                var maxRackets = Math.min(result.remaining_rackets, 10);
                $racketSelect.append('<option value="">Select</option>');
                for (var i = 1; i <= maxRackets; i++) {
                  $racketSelect.append('<option value="' + i + '">' + i + '</option>');
                }

                $racketNote.text("Only " + result.remaining_rackets + " rackets available for this slot.");
              }
            });
          }
        }

        $('input[name="booking_date"], select[name="slot_id"]').on('change', updateAvailability);
      });
      ]]>
    </script>
  </t>
</template>
</odoo>
