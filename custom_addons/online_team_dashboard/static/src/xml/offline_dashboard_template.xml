<templates id="offline_dashboard_templates" xml:space="preserve">
  <t t-name="offline_team_dashboard.OfflineTeamFilters">
   <!-- Period Dropdown -->
    <div style="min-width: 180px;">
        <select id="period_select" class="form-select o_input"  t-on-change="onDateRangeChange" t-ref="dateSelect">
            <option value="">Select period...</option>
            <option value="last_7" selected="selected">Last 7 Days</option>
            <option value="last_15">Last 15 Days</option>
            <option value="last_30">Last 30 Days</option>
            <option value="custom">Custom Range</option>
        </select>
    </div>
    <t t-if="state.show_custom_range">
<div id="custom_date_inputs" class="d-flex gap-2 align-items-center">
       <input type="date" class="form-control o_input" t-att-value="state.from_date" t-on-change="onFromDateChange" placeholder="From" style="min-width: 160px;" />
        <input type="date" class="form-control o_input" t-att-value="state.to_date" t-on-change="onToDateChange" placeholder="To" style="min-width: 160px;" />
    </div>
    </t>
    <!-- Salesperson -->
    <div style="min-width: 180px;">
    <div class="form-control o_input d-flex flex-wrap align-items-center gap-1" style="height: auto; max-height: 100px; overflow-y: auto;max-width:280px">
        <t t-foreach="state.selected_user_ids" t-as="uid" t-key="uid">
            <t t-set="user" t-value="state.users.find(u => u.id === uid)"/>
            <span class="badge rounded-pill text-bg-primary px-2 py-1">
                <t t-esc="user.name"/>
                <i class="fa fa-times ms-1 cursor-pointer" t-on-click="() => this.removeUser(uid)"></i>
            </span>
        </t>
        <select class="form-select border-0 p-0 flex-grow-1 bg-transparent"
                t-ref="userDropdown"
                t-on-change="onUserSelected"
                style="min-width: 120px; color: #6c757d;">
            <option value="">Select salesperson</option>
            <t t-foreach="state.users" t-as="user" t-key="user.id">
                <t t-if="!state.selected_user_ids.includes(user.id)">
                    <option t-att-value="user.id"><t t-esc="user.name"/></option>
                </t>
            </t>
        </select>
</div>
    </div>
    <div style="min-width: 90px;">
        <select t-model="state.tags" class="form-select o_input">
            <option value="">Tags</option>
            <option value="hot">Hot</option>
            <option value="warm">Warm</option>
        </select>
    </div>
    <div style="min-width: 90px;">
        <input type="text" class="form-control o_input" t-model="state.batch_code" placeholder="Batch Code"/>
    </div>
  </t>

  <t t-name="offline_team_dashboard.OfflineTeamDashboard">
                <div class="o_title">
                    <h1 class="mb-4">üìä Offline Sales Team Dashboard</h1>
                </div>

                <!-- Stat Boxes -->
                <div class="row mb-4 g-3" style="justify-content: space-between; max-width: 100%">
    <div class="col-md-2">
        <div class="alert alert-info shadow-sm d-flex flex-column justify-content-between" style="height: 170px;">
            <div>
                <div class="fw-bold">Total Leads:</div>
                <br/>
                <div class="display-6"><t t-esc="state.total_leads"/></div>
                <br/>
            </div>
            <div class="mt-auto small text-muted">
                üî• <strong>Hot:</strong> <t t-esc="state.hot_leads"/>
                <span style="margin: 0 6px;">|</span>
                üå°Ô∏è <strong>Warm:</strong> <t t-esc="state.warm_leads"/>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="alert alert-info shadow-sm d-flex flex-column justify-content-between" style="height: 170px;">
            <div>
                <div class="fw-bold">Unassigned Leads:</div>
                <br/>
                <div class="display-6"><t t-esc="state.unassigned_count"/></div>
                <br/>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="alert alert-warning shadow-sm d-flex flex-column justify-content-between" style="height: 170px;">
            <div>
                <div class="fw-bold">Total Touched:</div>
                <br/>
                <div class="display-6"><t t-esc="state.total_touched"/></div>
                <br/>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="alert alert-success shadow-sm d-flex flex-column justify-content-between" style="height: 170px;">
            <div>
                <div class="fw-bold">Total Enrolled:</div>
                <br/>
                <div class="display-6"><t t-esc="state.total_enrolled"/></div>
                <br/>
            </div>
            <div class="mt-auto small text-muted">
                üí∞ <strong>Full:</strong> <t t-esc="state.fully_paid"/>
                <span style="margin: 0 6px;">|</span>
                üí≥ <strong>Partial:</strong> <t t-esc="state.partially_paid"/>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="alert alert-danger shadow-sm d-flex flex-column justify-content-between" style="height: 170px;
    color: #d6580e;
    background-color: #f0a171;
    border-color: #ba632b;">
            <div>
                <div class="fw-bold">Total Walk-In:</div>
                <br/>
                <div class="display-6"><t t-esc="state.walk_in"/></div>
                <br/>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="alert alert-danger shadow-sm d-flex flex-column justify-content-between" style="height: 170px;">
            <div>
                <div class="fw-bold"> Conversion Rate:</div>
                <br/>
                <div t-attf-class="display-6 #{state.close_rate >= 70 ? 'text-white' : state.close_rate >= 40 ? 'text-dark' : 'text-white'}">
                    <t t-esc="state.close_rate"/>%
                </div>
                <br/>
            </div>
        </div>
    </div>
</div>

                <!-- Table View -->
                <div class="card shadow-sm mb-5" style="max-width: 98.5%">
                    <div class="table-responsive" style="max-height: 220px; overflow-y: auto;">
                        <table class="table table-striped table-bordered mb-0">
                            <thead class="table-light sticky-top bg-white" style="z-index: 5  !important;">
                                <tr>
                                <th>Salesperson</th>
                                <th>Assigned</th>
                                <th>Hot Leads</th>
                                <th>Warm Leads</th>
                                <th>Touched</th>
                                <th>UnTouched</th>
                                <th>Total Calls</th>
                                <th>Total Duration</th>
                                <th>Total Enrolled</th>
                                <th>Conversion Rate %</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-if="state.table and state.table.length">
                                    <t t-foreach="state.table" t-as="row" t-key="row.id">
                                        <tr>
                                            <td><t t-esc="row.name"/></td>
                                            <td><t t-esc="row.total_assigned"/></td>
                                            <td><t t-esc="row.hot_leads"/></td>
                                            <td><t t-esc="row.warm_leads"/></td>
                                            <td><t t-esc="row.total_touched"/></td>
                                            <td><t t-esc="row.untouched"/></td>
                                            <td><t t-esc="row.total_calls"/></td>
                                            <td><t t-esc="row.call_duration"/></td>
                                            <td><t t-esc="row.total_enrolled"/></td>
                                            <td><t t-esc="row.close_rate"/></td>
                                        </tr>
                                    </t>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Charts -->
                <div class="row g-4" style="max-width: 100%">
                    <div class="col-md-6">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header fw-bold">üìä Daily Call Volume</div>
                            <div class="card-body">
                                <div style="height: 350px;">
                                    <canvas t-ref="callVolumeCanvas" height="350" style="max-width: 100%;"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header fw-bold">üìä Touch Rate vs Assignment</div>
                            <div class="card-body">
                                <div style="height: 350px;">
                                    <canvas t-ref="touchRateCanvas" height="350" style="max-width: 100%;"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header fw-bold text-danger">üìå Lead Status Distribution</div>
                            <div class="card-body d-flex justify-content-center align-items-center" style="height: 350px;">
                                <canvas t-ref="statusPieCanvas" height="350" width="300" style="max-width: 100%; max-height: 100%;"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header fw-bold text-danger">üìå Batch Payment Status</div>
                            <div class="card-body d-flex justify-content-center align-items-center" style="height: 350px;">
                                <canvas t-ref="batchPaymentStatus" height="350" width="300" style="max-width: 100%; max-height: 100%;"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header fw-bold text-danger">üìå Batch Enrollment Summary</div>
                            <div class="table-responsive" style="max-height: 350px;height:350px; overflow-y: auto;">
                                <table class="table table-striped table-bordered w-100 m-0">
                                    <thead class="table-light sticky-top" style="z-index: 5  !important;">
                                    <tr>
                                        <th>Batch Code</th>
                                        <th>Total Leads</th>
                                        <th>Enrolled</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <t t-foreach="state.batch_enrollment_data" t-as="batch" t-key="batch.batch">
                                        <tr>
                                        <td><t t-esc="batch.batch"/></td>
                                        <td><t t-esc="batch.lead_count"/></td>
                                        <td><t t-esc="batch.enrolled_count"/></td>
                                        </tr>
                                    </t>
                                    </tbody>
                                </table>
                                </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header fw-bold text-primary">üìå Walk-In Leads</div>
                            <div class="card-body d-flex justify-content-center align-items-center" style="height: 350px;">
                                <canvas t-ref="walkInPieCanvas" height="350" width="300" style="max-width: 100%; max-height: 100%;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
  </t>
</templates>
