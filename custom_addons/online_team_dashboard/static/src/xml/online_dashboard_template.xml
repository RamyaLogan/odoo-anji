<templates id="online_dashboard_templates" xml:space="preserve">
  <t t-name="online_team_dashboard.OnlineTeamFilters">
   <!-- Period Dropdown -->
    <div style="min-width: 180px;">
        <select id="period_select" class="form-select o_input"  t-on-change="onDateRangeChange" t-ref="dateSelect">
            <option value="">Select period...</option>
            <option value="last_7" selected="selected" >Last 7 Days</option>
            <option value="last_15">Last 15 Days</option>
            <option value="last_30">Last 30 Days</option>
            <option value="custom">Custom Range</option>
        </select>
    </div>
    <t t-if="state.show_custom_range">
<div id="custom_date_inputs" class="d-flex gap-2 align-items-center">
       <input type="date" class="form-control o_input" t-att-value="state.from_date" t-on-change="onFromDateChange" placeholder="From" style="min-width: 160px;" />
        <input type="date" class="form-control o_input" t-att-value="state.to_date" t-on-change="onToDateChange" placeholder="To" style="min-width: 160px;" />
    </div>
    </t>
    <!-- Salesperson -->
    <div style="min-width: 180px;">
    <div class="form-control o_input d-flex flex-wrap align-items-center gap-1" style="height: auto; max-height: 100px; overflow-y: auto;max-width:280px">
        <t t-foreach="state.selected_user_ids" t-as="uid" t-key="uid">
            <t t-set="user" t-value="state.users.find(u => u.id === uid)"/>
            <span class="badge rounded-pill text-bg-primary px-2 py-1">
                <t t-esc="user.name"/>
                <i class="fa fa-times ms-1 cursor-pointer" t-on-click="() => this.removeUser(uid)"></i>
            </span>
        </t>
        <select class="form-select border-0 p-0 flex-grow-1 bg-transparent"
                t-ref="userDropdown"
                t-on-change="onUserSelected"
                style="min-width: 120px; color: #6c757d;">
            <option value="">Select salesperson</option>
            <t t-foreach="state.users" t-as="user" t-key="user.id">
                <t t-if="!state.selected_user_ids.includes(user.id)">
                    <option t-att-value="user.id"><t t-esc="user.name"/></option>
                </t>
            </t>
        </select>
</div>
    </div>
  </t>

  <t t-name="online_team_dashboard.OnlineTeamDashboard">
                <div class="o_title">
                    <h1 class="mb-4">ðŸ“Š Online Sales Team Dashboard</h1>
                </div>

                <!-- Stat Boxes -->
                <div class="row mb-4 g-3" style="justify-content: space-between; max-width: 100%">
    <div class="col-md-2">
        <div class="alert alert-info shadow-sm" style="height: 170px;">
            <div class="fw-bold">Total Leads:</div>
            <br/>
            <div class="display-6"><t t-esc="state.total_leads"/></div>
            <br/>
        </div>
    </div>
    <div class="col-md-2">
        <div class="alert alert-info shadow-sm" style="height: 170px;">
            <div class="fw-bold">Unassigned Leads:</div>
            <br/>
            <div class="display-6"><t t-esc="state.unassigned_leads"/></div>
            <br/>
        </div>
    </div>
    <div class="col-md-2">
        <div class="alert alert-warning shadow-sm" style="height: 170px;">
            <div class="fw-bold">Touched:</div>
            <br/>
            <div class="display-6"><t t-esc="state.total_touched"/></div>
            <br/>
        </div>
    </div>
    <div class="col-md-2">
        <div class="alert alert-success shadow-sm" style="height: 170px;">
            <div class="fw-bold">Done:</div>
            <br/>
            <div class="display-6"><t t-esc="state.total_done"/></div>
            <br/>
        </div>
    </div>
    <div class="col-md-2">
        <div class="alert alert-danger shadow-sm" style="height: 170px;
    color: #d6580e;
    background-color: #f0a171;
    border-color: #ba632b;">
            <div class="fw-bold">Total Calls Made:</div>
            <br/>
            <div class="display-6"><t t-esc="state.overall_total_calls"/></div>
            <br/>
        </div>
    </div>
    <div class="col-md-2">
        <div class="alert alert-danger shadow-sm" style="height: 170px;">
            <div class="fw-bold">Close Rate:</div>
            <br/>
            <div t-attf-class="display-6 #{state.close_rate >= 70 ? 'text-white' : state.close_rate >= 40 ? 'text-dark' : 'text-white'}">
                <t t-esc="state.close_rate"/>%
            </div>
            <br/>
        </div>
    </div>
</div>

                <!-- Table View -->
                <div class="card shadow-sm mb-5" style="max-width: 98.5%">
                    <div class="table-responsive" style="max-height: 220px; overflow-y: auto;">
                        <table class="table table-striped table-bordered mb-0">
                            <thead class="table-light sticky-top bg-white" style="z-index: 5  !important;">
                                <tr>
                                <th t-on-click="() => toggleSort('name')">Salesperson <t t-if="state.sort_field === 'name' and  state.sort_order === 'desc'">â–²</t></th>
                                <th t-on-click="() => toggleSort('total_assigned')">Assigned <t t-if="state.sort_field === 'total_assigned' and  state.sort_order === 'desc'">â–²</t></th>
                                <th t-on-click="() => toggleSort('total_touched')">Touched <t t-if="state.sort_field === 'total_touched' and  state.sort_order === 'desc'">â–²</t></th>
                                <th t-on-click="() => toggleSort('pending')">Pending <t t-if="state.sort_field === 'pending' and  state.sort_order === 'desc'">â–²</t></th>
                                <th t-on-click="() => toggleSort('done')">Total Interested <t t-if="state.sort_field === 'done' and  state.sort_order === 'desc'">â–²</t></th>
                                <th t-on-click="() => toggleSort('total_calls')">Total Calls <t t-if="state.sort_field === 'total_calls' and  state.sort_order === 'desc'">â–²</t></th>
                                <th t-on-click="() => toggleSort('call_duration')">Total Duration <t t-if="state.sort_field === 'call_duration' and  state.sort_order === 'desc'">â–²</t></th>
                                <th t-on-click="() => toggleSort('connected')">Connected % <t t-if="state.sort_field === 'connected' and  state.sort_order === 'desc'">â–²</t></th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-if="state.table and state.table.length">
                                    <t t-foreach="state.table" t-as="row" t-key="row.id">
                                        <tr>
                                            <td><t t-esc="row.name"/></td>
                                            <td><t t-esc="row.total_assigned"/></td>
                                            <td><t t-esc="row.total_touched"/></td>
                                            <td><t t-esc="row.pending"/></td>
                                            <td><t t-esc="row.done"/></td>
                                            <td><t t-esc="row.total_calls"/></td>
                                            <td><t t-esc="row.call_duration"/></td>
                                            <td><t t-esc="row.connected"/>%</td>
                                        </tr>
                                    </t>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Charts -->
                <div class="row g-4" style="max-width: 100%">
                    <div class="col-md-6">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header fw-bold">ðŸ“Š Daily Call Volume</div>
                            <div class="card-body">
                                <div style="height: 350px;">
                                    <canvas t-ref="callVolumeCanvas" height="350" style="max-width: 100%;"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header fw-bold">ðŸ“Š Touch Rate vs Assignment</div>
                            <div class="card-body">
                                <div style="height: 350px;">
                                    <canvas t-ref="touchRateCanvas" height="350" style="max-width: 100%;"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card shadow-sm mb-4">
                            <div class="card-header fw-bold text-danger">ðŸ“Œ Lead Status Distribution</div>
                            <div class="card-body d-flex justify-content-center align-items-center" style="height: 350px;">
                                <canvas t-ref="statusPieCanvas" height="350" width="300" style="max-width: 100%; max-height: 100%;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
  </t>
</templates>